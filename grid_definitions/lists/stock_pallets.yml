---
:dataminer_definition: stock_pallets
:actions:
  - :url: "/list/stock_pallet_sequences/with_params?key=standard&pallet_id=$:pallet_id$"
    :text: sequences
    :title: Pallet sequences for Pallet No $:pallet_number$
    :icon: list
    :popup: true
  - :url: "/finished_goods/dispatch/loads/$:load_id$/unship/$:pallet_number$"
    :text: Unship and Unallocate
    :icon: edit
    :hide_if_false: shipped
    :has_permission:
      - load
      - can_unship
:page_controls:
  - :control_type: :link
    :url: '/finished_goods/stock/set_local_pallet'
    :text: Set Local Pallets to Stock
    :style: :button
    :prompt: 'Are you sure you want to set all local pallets to stock?'
    :hide_for_key:
      - active
      - daily_pack
      - in_stock
      - unallocated_stock
      - scrapped
      - failed_inspections
      - failed_verifications
:captions:
  :conditions:
    :active: Active Pallets
    :daily_pack: Daily Pack Pallets
    :local_pack: Local Pack Pallets
    :in_stock: Pallets in stock
    :unallocated_stock: Unallocated Pallets
    :scrapped: Scrapped Pallets
    :failed_inspections: Failed Inspections Pallets
    :failed_verifications: Failed Verifications Pallets
:conditions:
  :standard:
    - :col: id
      :op: =
      :val: $:id$
  :active:
    - :col: active
      :op: =
      :val: $:active$
  :daily_pack:
    - :col: in_stock
      :op: =
      :val: $:in_stock$
    - :col: shipped
      :op: =
      :val: $:shipped$
  :local_pack:
    - :col: in_stock
      :op: =
      :val: false
    - :col: packed_tm_group
      :op: =
      :val: 'LO'
  :in_stock:
    - :col: in_stock
      :op: =
      :val: $:in_stock$
  :unallocated_stock:
    - :col: in_stock
      :op: =
      :val: $:in_stock$
    - :col: allocated
      :op: =
      :val: $:allocated$
  :scrapped:
    - :col: scrapped
      :op: =
      :val: $:scrapped$
  :failed_inspections:
    - :col: inspected
      :op: =
      :val: $:inspected$
    - :col: govt_inspection_passed
      :op: =
      :val: $:govt_inspection_passed$
  :failed_verifications:
    - :col: pallet_verification_failed
      :op: =
      :val: $:pallet_verification_failed$
  :unallocated_load_stock:
    - :col: in_stock
      :op: =
      :val: $:in_stock$
    - :col: zero_load_id
      :op: IN
      :val: $:id$,0
  :on_load:
    - :col: load_id
      :op: =
      :val: $:load_id$
  :shipped:
    - :col: shipped
      :op: =
      :val: $:shipped$
  :pallets_available_to_reworks:
    - :col: in_stock
      :op: =
      :val: false
    - :col: govt_inspection_passed
      :op: =
      :val: false
:multiselect:
  :allocate:
    :url: "/finished_goods/dispatch/loads/$:id$/allocate"
    :preselect: "SELECT id FROM vw_pallet_sequence_flat WHERE load_id = $:id$"
    :section_caption: "SELECT 'Assign pallets to load ' || order_number FROM loads WHERE id = $:id$"
    :multiselect_save_method: remote
    :can_be_cleared: true
    :conditions: unallocated_load_stock
  :reworks_pallets:
    :url: "/production/reworks/reworks_run_types/$:id$/reworks_runs/multiselect_reworks_run_pallets"
    :section_caption: "SELECT 'Select pallets for reworks run type: ' || run_type FROM reworks_run_types WHERE id = $:id$"
    :multiselect_save_method: remote
    :conditions: pallets_available_to_reworks